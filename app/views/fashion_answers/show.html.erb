<div class="fashion-results text-center">
  <h1>Fashion Profile Results</h1>

  <div class="card mb-3">
    <div class="card-header">AI thinks ...</div>
    <div class="card-body">

    </div>
  </div>

  <div class="card mb-3">
    <div class="card-header">What you said..</div>

    <div class="card-body justify-content-center">
      <div >
        <% if @fashion_answer.user_image.present? %>
          <%= cl_image_tag @fashion_answer.user_image.key, width: 600, height: 400, crop: :fill, gravity: :auto, alt: "Uploaded photo", class: "uploaded-photo user-image" %>
        <% else %>
        <p>No photo uploaded</p>
        <% end %>
      </div>
      <p><strong>Gender:</strong> <%= @fashion_answer.gender %></p>
      <p><strong>Lifestyle:</strong> <%= @fashion_answer.lifestyle %></p>
      <p><strong>Colors:</strong> <%= @fashion_answer.colors %></p>
      <p><strong>Occasion:</strong> <%= @fashion_answer.occasion %></p>
      <p><strong>Comfort:</strong> <%= @fashion_answer.comfort %></p>
      <p><strong>Statement:</strong> <%= @fashion_answer.statement %></p>
      <p><strong>Personality:</strong> <%= @fashion_answer.personality_type %></p>
      <% if @fashion_answer.price_min.present? && @fashion_answer.price_max.present? %>
        <p><strong>Price Preference:</strong>
          <%= @fashion_answer.currency == 'JPY' ? '¬•' : '$' %><%= number_with_delimiter(@fashion_answer.price_min) %> -
          <%= @fashion_answer.currency == 'JPY' ? '¬•' : '$' %><%= number_with_delimiter(@fashion_answer.price_max) %>
          (<%= @fashion_answer.currency %>)
        </p>
      <% end %>
    </div>
  </div>



  <h2>Fashion Profile Recommendations</h2>

  <% if @fashion_answer.style.present? %>
    <% if @fashion_answer.persona.present? %>
      <div class="card mb-3">
        <div class="card-body">
          <h3><%= @fashion_answer.persona %></h3>
        </div>
      </div>
    <% end %>

    <div class="card mb-3">
      <div class="card-header">Style</div>
      <div class="card-body">
        <p><%= @fashion_answer.style %></p>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header">Colour Palette</div>
      <div class="card-body">
        <div class="colour-swatches">
          <% @fashion_answer.colour_palette.split(',').each do |colour_name| %>
            <% hex = color_name_to_hex(colour_name) %>
            <div class="colour-swatch-item">
              <% if hex %>
                <span class="colour-sphere" style="background: <%= hex %>;"></span>
              <% end %>
              <span class="colour-label"><%= colour_name.strip %></span>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header">Recommended Brands</div>
      <div class="card-body">
        <p><%= @fashion_answer.recommended_brands %></p>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header">Where to Shop</div>
      <div class="card-body">
        <p><%= @fashion_answer.where_to_shop %></p>
      </div>
    </div>

    <!-- ‚úÖ AI Chat CTA (1 chat per quiz result) -->
    <div class="card mb-3">
      <div class="card-body">
        <h4 class="mb-2">üí¨ Ask your AI Stylist</h4>
        <p class="mb-3" style="color: rgba(255, 255, 255, 0.85);">
          Chat with an AI stylist using <strong>this exact quiz result</strong> (colors, lifestyle, budget, brands).
        </p>

        <%= button_to "Start / Continue Chat",
            fashion_answer_chat_path(@fashion_answer),
            method: :post,
            class: "btn btn-dark" %>
      </div>
    </div>

    <!-- Shop Your Style Section -->
    <% if @products.present? %>
      <div class="card mb-3">
        <div class="card-header">
          <h4 class="mb-0">üõçÔ∏è Shop Your Style</h4>
        </div>
        <div class="card-body">
          <p class="text-muted mb-4">Products matching your recommended brands and colors</p>
          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
            <% @products.first(8).each do |product| %>
              <div class="col">
                <div class="card h-100 product-card">
                  <% if product[:thumbnail].present? %>
                    <img src="<%= product[:thumbnail] %>" class="card-img-top" alt="<%= product[:title] %>" style="height: 200px; object-fit: contain; padding: 10px;">
                  <% end %>
                  <div class="card-body d-flex flex-column">
                    <h6 class="card-title" style="font-size: 0.9rem; line-height: 1.3; height: 2.6em; overflow: hidden;"><%= product[:title]&.truncate(60) %></h6>
                    <% if product[:source].present? %>
                      <p class="text-muted mb-1" style="font-size: 0.75rem;"><%= product[:source] %></p>
                    <% end %>
                    <% if product[:rating].present? %>
                      <p class="mb-1">
                        <% product[:rating].to_i.times do %>‚≠ê<% end %>
                        <small class="text-muted">(<%= product[:reviews] || 0 %>)</small>
                      </p>
                    <% end %>
                    <p class="card-text fw-bold text-success mt-auto"><%= product[:price] || 'Price unavailable' %></p>
                    <a href="<%= product[:link] %>" target="_blank" rel="noopener" class="btn btn-outline-primary btn-sm mt-2">View Product</a>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="card mb-3">
      <div class="card-body">
        <p>AI recommendations unavailable. Try again later or <%= link_to "retake the quiz", new_fashion_answer_path %>.</p>
      </div>
    </div>
  <% end %>

  <div class="mt-3">
    <%= link_to "Take Another Quiz", new_fashion_answer_path, class: "btn btn-primary" %>
    <%= link_to "View History", fashion_answers_path, class: "btn btn-secondary" %>
  </div>
</div>

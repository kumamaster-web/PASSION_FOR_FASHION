<div class="fashion-quiz">

  <h1>Fashion Quiz</h1>

  <%= simple_form_for @fashion_answer, html: { id: "fashion-quiz-form" } do |f| %>

    <div class="quiz-section">
      <h3>Upload Your Photo (Optional)</h3>

      <label class="upload-box">
        <%= f.file_field :user_image, class: "file-input", accept: "image/*" %>

        <img class="upload-preview" hidden />

        <div class="upload-content">
          <svg width="32" height="32" viewBox="0 0 24 24">
            <path d="M12 16V8M8 12l4-4 4 4"
            stroke="currentColor"
            stroke-width="2"
            fill="none"/>
          </svg>
          <p><strong>Click to upload an image</strong></p>
          <span>PNG, JPG up to 10MB</span>
        </div>
      </label>
    </div>

    <div class="quiz-section">
      <h3>Gender</h3>

        <div class="option-buttons">
        <% ["Female", "Male", "Non-binary", "Prefer not to say"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :gender, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Lifestyle</h3>

      <div class="option-buttons">
        <% ["Professional", "Casual", "Active", "Creative", "Student"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :lifestyle, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Colors</h3>

      <div class="option-buttons">
        <% ["Neutrals", "Bold", "Pastels", "Earth tones", "Monochrome"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :colors, option, class: "option-input" %>
            <span><%= option %></span>
            </label>
          <% end %>
        </div>
    </div>

    <div class="quiz-section">
      <h3>Occasion</h3>

        <div class="option-buttons">
        <% ["Work", "Weekend", "Evening", "Travel", "Special events"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :occasion, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Comfort</h3>

        <div class="option-buttons">
        <% ["Very important", "Somewhat important", "Style over comfort", "Balanced"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :comfort, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Statement</h3>

        <div class="option-buttons">
        <% ["Classic", "Trendy", "Edgy", "Romantic", "Minimalist"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :statement, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

    <div class="quiz-section">
      <h3>Personality</h3>

        <div class="option-buttons">
        <% ["Introvert", "Extrovert", "Ambivert"].each do |option| %>
          <label class="option-btn">
            <%= f.radio_button :personality_type, option, class: "option-input" %>
            <span><%= option %></span>
          </label>
        <% end %>
      </div>
    </div>

  <div>
    <h3>On average, what price window per item are you comfortable spending?</h3>

    <div class="mb-3 text-center">
      <label class="form-label d-block">Currency:</label>
      <div class="btn-group" role="group" aria-label="Currency selection">
        <input type="radio" class="btn-check" name="fashion_answer[currency]" id="currency_jpy" value="JPY" checked>
        <label class="btn slider_selector" for="currency_jpy">JPY (¥)</label>

        <input type="radio" class="btn-check" name="fashion_answer[currency]" id="currency_usd" value="USD">
        <label class="btn slider_selector" for="currency_usd">USD ($)</label>
      </div>
    </div>

    <!-- Price Range Display -->
    <div class="text-center mb-3">
      <h4 id="price_range_display">¥1,000 - ¥20,000</h4>
    </div>

    <!-- Dual Range Slider -->
    <div class="dual-range-container" style="position: relative; height: 40px; margin: 20px auto; width: 70%; max-width: 400px;">
      <div class="slider-track" style="position: absolute; width: 100%; height: 6px; background: #ddd; border-radius: 3px; top: 50%; transform: translateY(-50%);"></div>
      <div id="slider-range" style="position: absolute; height: 6px; background: linear-gradient(135deg, #ff6a3d, #ff9a3d); border-radius: 3px; top: 50%; transform: translateY(-50%);"></div>

      <input type="range" id="price_min" name="fashion_answer[price_min]"
             min="1000" max="500000" step="1000" value="1000"
             data-jpy-min="1000" data-jpy-max="500000" data-jpy-step="1000"
             data-usd-min="10" data-usd-max="5000" data-usd-step="10"
             style="position: absolute; width: 100%; height: 6px; -webkit-appearance: none; background: transparent; pointer-events: none; top: 50%; transform: translateY(-50%);">

      <input type="range" id="price_max" name="fashion_answer[price_max]"
             min="1000" max="500000" step="1000" value="20000"
             data-jpy-min="1000" data-jpy-max="500000" data-jpy-step="1000"
             data-usd-min="10" data-usd-max="5000" data-usd-step="10"
             style="position: absolute; width: 100%; height: 6px; -webkit-appearance: none; background: transparent; pointer-events: none; top: 50%; transform: translateY(-50%);">
    </div>

    <!-- Min/Max Labels -->
    <div class="d-flex justify-content-between" style="width: 70%; max-width: 400px; margin: 0 auto;">
      <span id="min_label">¥1,000</span>
      <span id="max_label">¥500,000</span>
    </div>
  </div>

  <style>
    /* Dual range slider styles */
    .dual-range-container input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      pointer-events: none;
    }

    .dual-range-container input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #ff6a3d, #ff9a3d);
      border: 3px solid #fff;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .dual-range-container input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #ff6a3d, #ff9a3d);
      border: 3px solid #fff;
      border-radius: 50%;
      cursor: pointer;
      pointer-events: auto;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
  </style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const priceMin = document.getElementById('price_min');
      const priceMax = document.getElementById('price_max');
      const priceRangeDisplay = document.getElementById('price_range_display');
      const sliderRange = document.getElementById('slider-range');
      const minLabel = document.getElementById('min_label');
      const maxLabel = document.getElementById('max_label');
      const currencyJpy = document.getElementById('currency_jpy');
      const currencyUsd = document.getElementById('currency_usd');

      function formatPrice(value, currency) {
        if (currency === 'JPY') {
          return '¥' + parseInt(value).toLocaleString();
        } else {
          return '$' + parseInt(value).toLocaleString();
        }
      }

      function getCurrentCurrency() {
        return currencyJpy.checked ? 'JPY' : 'USD';
      }

      function updateSliderTrack() {
        const min = parseInt(priceMin.min);
        const max = parseInt(priceMin.max);
        const minVal = parseInt(priceMin.value);
        const maxVal = parseInt(priceMax.value);

        const minPercent = ((minVal - min) / (max - min)) * 100;
        const maxPercent = ((maxVal - min) / (max - min)) * 100;

        sliderRange.style.left = minPercent + '%';
        sliderRange.style.width = (maxPercent - minPercent) + '%';
      }

      function updateDisplays() {
        const currency = getCurrentCurrency();
        const minVal = parseInt(priceMin.value);
        const maxVal = parseInt(priceMax.value);

        priceRangeDisplay.textContent = formatPrice(minVal, currency) + ' - ' + formatPrice(maxVal, currency);
        updateSliderTrack();
      }

      function updateLabels() {
        const currency = getCurrentCurrency();
        minLabel.textContent = formatPrice(priceMin.min, currency);
        maxLabel.textContent = formatPrice(priceMin.max, currency);
      }

      function updateSliderRanges() {
        const currency = getCurrentCurrency();

        if (currency === 'JPY') {
          priceMin.min = priceMin.dataset.jpyMin;
          priceMin.max = priceMin.dataset.jpyMax;
          priceMin.step = priceMin.dataset.jpyStep;
          priceMin.value = 1000;

          priceMax.min = priceMax.dataset.jpyMin;
          priceMax.max = priceMax.dataset.jpyMax;
          priceMax.step = priceMax.dataset.jpyStep;
          priceMax.value = 20000;
        } else {
          priceMin.min = priceMin.dataset.usdMin;
          priceMin.max = priceMin.dataset.usdMax;
          priceMin.step = priceMin.dataset.usdStep;
          priceMin.value = 10;

          priceMax.min = priceMax.dataset.usdMin;
          priceMax.max = priceMax.dataset.usdMax;
          priceMax.step = priceMax.dataset.usdStep;
          priceMax.value = 200;
        }

        updateLabels();
        updateDisplays();
      }

      // Ensure min doesn't exceed max
      priceMin.addEventListener('input', function() {
        if (parseInt(priceMin.value) > parseInt(priceMax.value)) {
          priceMax.value = priceMin.value;
        }
        updateDisplays();
      });

      priceMax.addEventListener('input', function() {
        if (parseInt(priceMax.value) < parseInt(priceMin.value)) {
          priceMin.value = priceMax.value;
        }
        updateDisplays();
      });

      currencyJpy.addEventListener('change', updateSliderRanges);
      currencyUsd.addEventListener('change', updateSliderRanges);

      // Initialize
      updateLabels();
      updateDisplays();
    });
  </script>

    <div class="quiz-section submit-section">
      <%= f.submit "Get Advice", class: "btn btn-primary" %>
    </div>

  <% end %>

</div>
